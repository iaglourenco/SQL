--EXERCICIOS PROVA


--CRIANDO TABELAS
CREATE TABLE FUNCIONARIOS (NUM VARCHAR2(5),NOME VARCHAR2(20), DT_NASC DATE, C_DEPTO VARCHAR2(4),  SAL NUMBER);

CREATE TABLE DEPARTAMENTOS (COD VARCHAR2(4), NOME VARCHAR2(10), LOCALI VARCHAR2(10), SAL_TOTAL NUMBER);

ALTER TABLE FUNCIONARIOS ADD CONSTRAINT PK_FUNCIONARIOS  PRIMARY KEY (NUM);

ALTER TABLE DEPARTAMENTOS  ADD CONSTRAINT PK_DEPTO  PRIMARY KEY (COD);


--INSERTS NECESSARIOS PARA TESTE
INSERT INTO DEPARTAMENTOS (COD,NOME,LOCALI) VALUES('0004','Marketing','Valinhos');
INSERT INTO DEPARTAMENTOS (COD,NOME,LOCALI) VALUES('0001','Compras','Campinas');
INSERT INTO DEPARTAMENTOS (COD,NOME,LOCALI) VALUES('0002','Vendas','Campinas');
INSERT INTO DEPARTAMENTOS (COD,NOME,LOCALI) VALUES('0003','Financeiro','Sao Paulo');

INSERT INTO FUNCIONARIOS VALUES ('00010','Jessica',TO_DATE('22/05/87','dd/mm/yy'),'0001',500);
INSERT INTO FUNCIONARIOS VALUES ('00020','Marquinhos',TO_DATE('16/09/60','dd/mm/yy'),'0001',500);
INSERT INTO FUNCIONARIOS VALUES ('00030','Joao',TO_DATE('12/04/70','dd/mm/yy'),'0002',800);
INSERT INTO FUNCIONARIOS VALUES ('00040','Juninho',TO_DATE('11/11/99','dd/mm/yy'),'0001',200);
INSERT INTO FUNCIONARIOS VALUES ('00050','Zezinho',TO_DATE('12/11/99','dd/mm/yy'),'0002',200);
INSERT INTO FUNCIONARIOS VALUES ('00060','Luizinho',TO_DATE('12/11/99','dd/mm/yy'),'0003',300);
INSERT INTO FUNCIONARIOS VALUES ('00070','Mariazinha',TO_DATE('11/01/00','dd/mm/yy'),'0003',300);
INSERT INTO FUNCIONARIOS VALUES ('00080','Paulo',TO_DATE('20/08/87','dd/mm/yy'),'0004',1000);
INSERT INTO FUNCIONARIOS VALUES ('00090','Cassio',TO_DATE('21/02/84','dd/mm/yy'),'0002',1600);
INSERT INTO FUNCIONARIOS VALUES ('00100','Maria',TO_DATE('20/01/92','dd/mm/yy'),'0003',1400);



--A
ALTER TABLE FUNCIONARIOS ADD CONSTRAINT FK_COD_DEPTO FOREIGN KEY (C_DEPTO) REFERENCES DEPARTAMENTOS;


--B			--RESPOSTA= B
--1
SELECT LOCALI, COUNT(*) AS QTDE FROM FUNCIONARIOS, DEPARTAMENTOS GROUP BY LOCALI;



--2	RESPOSTA=E
SELECT S.NOME FROM FUNCIONARIOS T, FUNCIONARIOS S WHERE  T.NUM = '00010' AND T.SAL > S.SAL;

--3 RESPOSTA=B
SELECT  NOME FROM  FUNCIONARIOS  WHERE SAL = 500 AND SAL =   800  AND  SAL =   200  AND SAL = 300 AND SAL = 1000  AND  SAL = 1600  AND SAL = 1400;

--4 RESPOSTA=D
SELECT C_DEPTO AS DEPTO , COUNT(*) AS QTDE FROM FUNCIONARIOS WHERE SAL  >  500 GROUP BY C_DEPTO;

--5 RESPOSTA=D
SELECT NOME FROM FUNCIONARIOS WHERE SAL >  (SELECT MIN (SAL) FROM FUNCIONARIOS);

--6


--C
--1
SELECT LOCALI, MIN(SAL), MAX(SAL)
       FROM FUNCIONARIOS, DEPARTAMENTOS
       WHERE FUNCIONARIOS.C_DEPTO = DEPARTAMENTOS.COD
       GROUP BY LOCALI;
	
--RESPOSTA:
--
--	LOCALI       MIN(SAL)   MAX(SAL)
--	---------- ---------- ----------
--	Campinas          200       1600
--	Valinhos         1000       1000
--	Sao Paulo         300       1400


--2
SELECT  FUNCIONARIOS.NOME, DEPARTAMENTOS.NOME
       FROM FUNCIONARIOS, DEPARTAMENTOS
       WHERE FUNCIONARIOS.C_DEPTO = DEPARTAMENTOS.COD;
	   
--RESPOSTA:
--
--	NOME                 NOME
--	-------------------- ----------
--	Jessica              Compras
--	Marquinhos           Compras
--	Joao                 Vendas
--	Juninho              Compras
--	Zezinho              Vendas
--	Luizinho             Financeiro
--	Mariazinha           Financeiro
--	Paulo                Marketing
--	Cassio               Vendas
--	Maria                Financeiro


--D
--a



--E

CREATE OR REPLACE PROCEDURE INS_SAL_TOT
AS
BEGIN

	FOR rSAL IN(SELECT SUM(SAL) AS SAL_TOT FROM FUNCIONARIOS,DEPARTAMENTOS WHERE C_DEPTO = DEPARTAMENTOS.COD)
	
	LOOP
	
	INSERT INTO DEPARTAMENTOS (SAL_TOTAL) VALUES (rSAL.SAL_TOT);
	
	END LOOP;

END;



--F
CREATE OR REPLACE TRIGGER ATT_SAL_TOT
AFTER DELETE ON FUNCIONARIOS
FOR EACH ROW
BEGIN

	UPDATE DEPARTAMENTOS SET SAL_TOTAL = SAL_TOTAL - :OLD.SAL WHERE COD = :NEW.C_DEPTO;

END;












